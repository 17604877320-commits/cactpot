<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FF14 ä»™äººå¾®å½© ç­–ç•¥åŠ©æ‰‹</title>
    <style>
        :root { 
            --gold: #d4af37; 
            --brown: #5d4037; 
            --coffee-light: #eaddca; 
            --card-bg: #ffffff; 
            --accent: #e67e22; 
        }
        * { box-sizing: border-box; }
        body { 
            font-family: 'PingFang SC', -apple-system, sans-serif; 
            background: var(--coffee-light); 
            color: var(--brown); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 15px 10px; 
            margin: 0;
            min-height: 100vh;
        }
        h2 { font-size: 1.5rem; color: var(--brown); border-bottom: 3px solid var(--gold); padding-bottom: 5px; margin: 10px 0; }
        .hint-box { margin-bottom: 12px; font-weight: bold; color: var(--accent); font-size: 0.9rem; height: 1.2rem; }
        
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            padding: 15px; 
            background: var(--brown); 
            border-radius: 15px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
            width: 100%;
            max-width: 280px; /* é™åˆ¶æ‰‹æœºç«¯æœ€å¤§å®½åº¦ */
        }
        input { 
            width: 100%; 
            aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢ */
            text-align: center; font-size: 28px; 
            background: #fff; border: 3px solid transparent; 
            border-radius: 10px; color: var(--brown); 
            font-weight: bold; transition: 0.3s; 
            -webkit-appearance: none; margin: 0;
        }
        input:focus { outline: none; border-color: var(--gold); }
        
        input.best-line-cell { border-color: var(--gold); background: #fff9c4; animation: goldGlow 1.5s infinite; }
        input.suggest-next { border-color: #3498db; }
        input.error { border-color: #e74c3c; color: #e74c3c; }

        @keyframes goldGlow { 
            0% { box-shadow: 0 0 5px var(--gold); } 
            50% { box-shadow: 0 0 15px var(--gold); } 
            100% { box-shadow: 0 0 5px var(--gold); } 
        }

        .controls { margin: 15px 0; }
        button { 
            padding: 8px 25px; font-size: 15px; 
            background: var(--brown); color: var(--gold); 
            border: 2px solid var(--gold); border-radius: 20px; 
            cursor: pointer; font-weight: bold; 
        }

        .results-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 8px; }
        .line-card { 
            background: var(--card-bg); 
            padding: 10px 15px; 
            border-radius: 10px; 
            border: 1px solid #dcdcdc; 
            display: flex; flex-direction: column; 
            transition: 0.3s;
            opacity: 0.5;
        }
        .line-card.active { 
            opacity: 1; 
            border: 2px solid var(--gold);
            border-left: 6px solid var(--gold); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: scale(1.02);
        }
        .line-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px; }
        .line-name { font-weight: bold; font-size: 14px; }
        .line-exp { font-size: 14px; }
        .line-detail { font-size: 12px; color: #777; line-height: 1.4; }
        .prob-tag { color: var(--accent); font-weight: bold; }

        footer { margin-top: 30px; font-size: 12px; color: var(--brown); opacity: 0.6; padding-bottom: 20px; }
    </style>
</head>
<body>
    <h2>MINI CACTPOT PRO</h2>
    <div class="hint-box" id="hint">è¯·å¡«å…¥å·²æ­å¼€çš„æ•°å­—</div>
    
    <div class="grid-container" id="grid">
        <input type="number" pattern="[1-9]*" id="idx0">
        <input type="number" pattern="[1-9]*" id="idx1">
        <input type="number" pattern="[1-9]*" id="idx2">
        <input type="number" pattern="[1-9]*" id="idx3">
        <input type="number" pattern="[1-9]*" id="idx4">
        <input type="number" pattern="[1-9]*" id="idx5">
        <input type="number" pattern="[1-9]*" id="idx6">
        <input type="number" pattern="[1-9]*" id="idx7">
        <input type="number" pattern="[1-9]*" id="idx8">
    </div>

    <div class="controls">
        <button onclick="resetAll()">é‡ç½®è®¡ç®—å™¨</button>
    </div>

    <div class="results-container" id="output"></div>

    <footer>Author: @ç«‹å¤</footer>

    <script>
        const rewards = {6:10000, 7:36, 8:720, 9:360, 10:80, 11:252, 12:108, 13:72, 14:54, 15:180, 16:72, 17:180, 18:119, 19:36, 20:306, 21:1080, 22:144, 23:1800, 24:3600};
        const lines = [
            {n: "ç¬¬ä¸€æ¨ª (ä¸Š)", idx: [0,1,2]}, {n: "ç¬¬äºŒæ¨ª (ä¸­)", idx: [3,4,5]}, {n: "ç¬¬ä¸‰æ¨ª (ä¸‹)", idx: [6,7,8]},
            {n: "ç¬¬ä¸€ç«– (å·¦)", idx: [0,3,6]}, {n: "ç¬¬äºŒç«– (ä¸­)", idx: [1,4,7]}, {n: "ç¬¬ä¸‰ç«– (å³)", idx: [2,5,8]},
            {n: "å·¦æ–œ â†˜", idx: [0,4,8]}, {n: "å³æ–œ â†™", idx: [2,4,6]}
        ];

        document.getElementById('grid').addEventListener('input', (e) => {
            if (e.target.value.length > 1) e.target.value = e.target.value.slice(0,1);
            calculate();
        });

        function resetAll() {
            document.querySelectorAll('input').forEach(i => i.value = '');
            calculate();
        }

        function getCombos(arr, n) {
            if (n === 0) return [[]];
            let res = [];
            for(let i=0; i<arr.length; i++) {
                let rest = getCombos(arr.slice(0,i).concat(arr.slice(i+1)), n-1);
                rest.forEach(r => res.push([arr[i], ...r]));
            }
            return res;
        }

        function calculate() {
            const board = Array.from({length: 9}, (_, i) => parseInt(document.getElementById('idx'+i).value) || null);
            const used = board.filter(v => v !== null);
            const remaining = [1,2,3,4,5,6,7,8,9].filter(v => !used.includes(v));
            const isReady = used.length >= 4;

            let hasError = false;
            document.querySelectorAll('input').forEach((el, i) => {
                el.classList.remove('error', 'suggest-next', 'best-line-cell');
                if (board[i] && board.filter(v => v === board[i]).length > 1) {
                    el.classList.add('error');
                    hasError = true;
                }
            });
            if (hasError) { document.getElementById('hint').innerText = "âš ï¸ æ•°å­—é‡å¤"; return; }

            if (used.length > 0 && used.length < 4) {
                let bestPos = -1; let maxL = -1;
                board.forEach((v, i) => {
                    if(v === null) {
                        let cnt = lines.filter(l => l.idx.includes(i)).length;
                        if(cnt > maxL) { maxL = cnt; bestPos = i; }
                    }
                });
                document.getElementById('idx'+bestPos).classList.add('suggest-next');
                document.getElementById('hint').innerText = "âœ¨ ç¿»å¼€è“è‰²è¾¹æ¡†æ ¼å­";
            } else {
                document.getElementById('hint').innerText = isReady ? "âœ… æœ€ä¼˜è·¯çº¿å·²ç½®é¡¶" : "è¯·è¾“å…¥æ•°å­—å¼€å§‹...";
            }

            let lineResults = lines.map(line => {
                const curValues = line.idx.map(i => board[i]);
                const emptyCount = curValues.filter(v => v === null).length;
                const currentSum = curValues.reduce((a, b) => a + (b || 0), 0);
                let sums = [];
                getCombos(remaining, emptyCount).forEach(p => { 
                    sums.push(currentSum + p.reduce((a,b) => a+b, 0)); 
                });
                let counts = {};
                sums.forEach(s => { let m = rewards[s]; counts[m] = (counts[m] || 0) + 1; });
                let sortedList = Object.keys(counts).map(Number).sort((a,b) => b-a).map(m => ({
                    val: m, p: ((counts[m]/sums.length)*100).toFixed(0)+'%'
                }));
                return { 
                    name: line.n, 
                    exp: sums.length ? (sums.reduce((a,s)=>a+rewards[s],0)/sums.length) : 0, 
                    min: sortedList.length ? sortedList[sortedList.length-1].val : 0, 
                    details: sortedList, 
                    idx: line.idx 
                };
            });

            if (isReady) lineResults.sort((a, b) => b.exp - a.exp);
            const topExp = isReady ? lineResults[0].exp : -1;

            if (isReady && topExp > 0) {
                lineResults[0].idx.forEach(i => document.getElementById('idx'+i).classList.add('best-line-cell'));
            }

            document.getElementById('output').innerHTML = lineResults.map((l, index) => {
                const isActive = isReady && index === 0 && topExp > 0;
                return `
                <div class="line-card ${isActive ? 'active' : ''}">
                    <div class="line-header">
                        <span class="line-name">${isActive ? 'ğŸ† ' : ''}${l.name}</span>
                        <span class="line-exp">æœŸæœ›: <strong>${isReady ? Math.round(l.exp) : '---'}</strong></span>
                    </div>
                    <div class="line-detail">
                        ${isReady ? `ä¿åº•: ${l.min} | ` + l.details.map(d => `${d.val}(<span class="prob-tag">${d.p}</span>)`).join(' ') : 'ç­‰å¾…æ•°æ®...'}
                    </div>
                </div>
                `;
            }).join('');
        }
        calculate();
    </script>
</body>
</html>
